{% extends "shared/skeleton.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8 text-mc-white">
    <div class="max-w-4xl mx-auto">
        <!-- Breadcrumb -->
        <nav class="mb-6">
            <ol class="flex items-center space-x-2 text-sm text-mc-light-grey">
                <li><a href="{% url 'order_history' %}" class="hover:text-mc-accent transition-colors">Order History</a></li>
                <li><span class="mx-2">/</span></li>
                <li class="text-mc-white">Order #{{ order.id }}</li>
            </ol>
        </nav>

        <!-- Order Header -->
        <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30 mb-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-mc-white">Order #{{ order.id }}</h1>
                    <p class="text-mc-light-grey mt-1">Placed on {{ order.created_at|date:"F d, Y at g:i A" }}</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-mc-white mb-1">Rs {{ order.total_amount }}</div>
                    <span class="status-badge status-{{ order.status }}">
                        {{ order.status_display }}
                    </span>
                </div>
            </div>
            
            <!-- Order Progress -->
            <div class="mt-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-mc-white">Order Progress</h3>
                </div>
                <div class="relative">
                    <div class="flex items-center justify-between">
                        <!-- Pending -->
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mb-2
                                        {% if order.status == 'pending' %}
                                            bg-mc-accent border-mc-accent text-mc-black
                                        {% elif order.status in 'confirmed,processing,shipped,out_for_delivery,delivered' %}
                                            bg-green-500 border-green-500 text-white
                                        {% else %}
                                            border-mc-grey text-mc-grey
                                        {% endif %}">
                                ‚è≥
                            </div>
                            <span class="text-xs text-mc-light-grey text-center">Pending</span>
                        </div>
                        <div class="flex-1 h-0.5 mx-4
                                    {% if order.status in 'confirmed,processing,shipped,out_for_delivery,delivered' %}
                                        bg-green-500
                                    {% else %}
                                        bg-mc-grey/30
                                    {% endif %}"></div>
                        
                        <!-- Confirmed -->
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mb-2
                                        {% if order.status == 'confirmed' %}
                                            bg-mc-accent border-mc-accent text-mc-black
                                        {% elif order.status in 'processing,shipped,out_for_delivery,delivered' %}
                                            bg-green-500 border-green-500 text-white
                                        {% else %}
                                            border-mc-grey text-mc-grey
                                        {% endif %}">
                                ‚úÖ
                            </div>
                            <span class="text-xs text-mc-light-grey text-center">Confirmed</span>
                        </div>
                        <div class="flex-1 h-0.5 mx-4
                                    {% if order.status in 'processing,shipped,out_for_delivery,delivered' %}
                                        bg-green-500
                                    {% else %}
                                        bg-mc-grey/30
                                    {% endif %}"></div>
                        
                        <!-- Processing -->
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mb-2
                                        {% if order.status == 'processing' %}
                                            bg-mc-accent border-mc-accent text-mc-black
                                        {% elif order.status in 'shipped,out_for_delivery,delivered' %}
                                            bg-green-500 border-green-500 text-white
                                        {% else %}
                                            border-mc-grey text-mc-grey
                                        {% endif %}">
                                üîß
                            </div>
                            <span class="text-xs text-mc-light-grey text-center">Processing</span>
                        </div>
                        <div class="flex-1 h-0.5 mx-4
                                    {% if order.status in 'shipped,out_for_delivery,delivered' %}
                                        bg-green-500
                                    {% else %}
                                        bg-mc-grey/30
                                    {% endif %}"></div>
                        
                        <!-- Shipped -->
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mb-2
                                        {% if order.status == 'shipped' %}
                                            bg-mc-accent border-mc-accent text-mc-black
                                        {% elif order.status in 'out_for_delivery,delivered' %}
                                            bg-green-500 border-green-500 text-white
                                        {% else %}
                                            border-mc-grey text-mc-grey
                                        {% endif %}">
                                üì¶
                            </div>
                            <span class="text-xs text-mc-light-grey text-center">Shipped</span>
                        </div>
                        <div class="flex-1 h-0.5 mx-4
                                    {% if order.status in 'out_for_delivery,delivered' %}
                                        bg-green-500
                                    {% else %}
                                        bg-mc-grey/30
                                    {% endif %}"></div>
                        
                        <!-- Out for Delivery -->
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mb-2
                                        {% if order.status == 'out_for_delivery' %}
                                            bg-mc-accent border-mc-accent text-mc-black
                                        {% elif order.status == 'delivered' %}
                                            bg-green-500 border-green-500 text-white
                                        {% else %}
                                            border-mc-grey text-mc-grey
                                        {% endif %}">
                                üöö
                            </div>
                            <span class="text-xs text-mc-light-grey text-center">Out for Delivery</span>
                        </div>
                        <div class="flex-1 h-0.5 mx-4
                                    {% if order.status == 'delivered' %}
                                        bg-green-500
                                    {% else %}
                                        bg-mc-grey/30
                                    {% endif %}"></div>
                        
                        <!-- Delivered -->
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mb-2
                                        {% if order.status == 'delivered' %}
                                            bg-mc-accent border-mc-accent text-mc-black
                                        {% else %}
                                            border-mc-grey text-mc-grey
                                        {% endif %}">
                                üéâ
                            </div>
                            <span class="text-xs text-mc-light-grey text-center">Delivered</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Processing Message for Pending Orders -->
        {% if order.status == 'pending' %}
        <div class="bg-gradient-to-r from-mc-accent/20 to-mc-accent/10 rounded-xl p-6 border border-mc-accent/30 mb-6">
            <div class="flex items-start space-x-4">
                <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-mc-accent rounded-full flex items-center justify-center">
                        <i class="fas fa-phone text-mc-black text-xl"></i>
                    </div>
                </div>
                <div class="flex-1">
                    <h3 class="text-xl font-bold text-mc-white mb-2">Order Processing</h3>
                    <p class="text-mc-light-grey mb-3">
                        Your order has been successfully placed! Our team is currently processing your order and will contact you shortly to discuss payment options and delivery details.
                    </p>
                    <div class="bg-mc-black/50 rounded-lg p-4 border border-mc-accent/30">
                        <p class="text-mc-accent font-semibold text-lg">
                            <i class="fas fa-info-circle mr-2"></i>
                            You will soon get a message from our representative
                        </p>
                        <p class="text-mc-light-grey text-sm mt-2">
                            Please ensure your phone number is correct so we can reach you easily.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Order Items -->
                <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30">
                    <h2 class="text-xl font-semibold mb-4 text-mc-white">Order Items</h2>
                    <div class="space-y-4">
                        {% for item in order.items.all %}
                        <div class="flex items-center justify-between py-4 border-b border-mc-grey/20 last:border-b-0">
                            <div class="flex items-center space-x-4">
                                {% if item.product.primary_image %}
                                <img src="{{ item.product.primary_image }}" 
                                     alt="{{ item.product.name }}"
                                     class="w-16 h-16 object-cover rounded-lg">
                                {% else %}
                                <div class="w-16 h-16 bg-mc-grey/30 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-image text-mc-grey"></i>
                                </div>
                                {% endif %}
                                <div>
                                    <h3 class="font-semibold text-mc-white">{{ item.product.name }}</h3>
                                    <p class="text-mc-light-grey text-sm">
                                        Quantity: {{ item.quantity }}
                                        {% if item.color %}
                                        ‚Ä¢ Color: 
                                        {% if item.color.hex_code %}
                                        <span class="inline-flex items-center gap-1">
                                            <div class="w-3 h-3 rounded-full border border-mc-grey/50" 
                                                 style="background-color: {{ item.color.hex_code }};"></div>
                                            {{ item.color.name }}
                                        </span>
                                        {% else %}
                                        {{ item.color.name }}
                                        {% endif %}
                                        {% endif %}
                                    </p>
                                    <p class="text-mc-light-grey text-sm">Rs {{ item.price }} each</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold text-mc-white">Rs {{ item.subtotal }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Tracking Information -->
                {% if order.tracking_id %}
                <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30">
                    <h2 class="text-xl font-semibold mb-4 text-mc-white">üöö Tracking Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-mc-light-grey text-sm">Tracking ID</p>
                            <p class="text-mc-white font-semibold">{{ order.tracking_id }}</p>
                        </div>
                        {% if order.delivery_service %}
                        <div>
                            <p class="text-mc-light-grey text-sm">Delivery Service</p>
                            <p class="text-mc-white font-semibold">{{ order.delivery_service.name }}</p>
                        </div>
                        {% endif %}
                        {% if order.shipped_date %}
                        <div>
                            <p class="text-mc-light-grey text-sm">Shipped Date</p>
                            <p class="text-mc-white font-semibold">{{ order.shipped_date|date:"F d, Y" }}</p>
                        </div>
                        {% endif %}
                        {% if order.estimated_delivery_date %}
                        <div>
                            <p class="text-mc-light-grey text-sm">Estimated Delivery</p>
                            <p class="text-mc-white font-semibold">{{ order.estimated_delivery_date|date:"F d, Y" }}</p>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if order.tracking_url %}
                    <div class="mt-4">
                        <a href="{{ order.tracking_url }}" 
                           target="_blank"
                           class="inline-flex items-center px-4 py-2 bg-mc-accent text-mc-black hover:bg-mc-accent/90 transition-colors duration-300 rounded-lg font-semibold">
                            <i class="fas fa-external-link-alt mr-2"></i>
                            Track Package
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Order Notes -->
                {% if order.notes %}
                <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30">
                    <h2 class="text-xl font-semibold mb-4 text-mc-white">üìù Order Notes</h2>
                    <p class="text-mc-light-grey">{{ order.notes }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Order Summary -->
                <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30">
                    <h3 class="text-lg font-semibold mb-4 text-mc-white">Order Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-mc-light-grey">Subtotal</span>
                            <span class="text-mc-white">Rs {{ order.total_amount }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-mc-light-grey">Shipping</span>
                            <span class="text-mc-white">Free</span>
                        </div>
                        <div class="border-t border-mc-grey/30 pt-3">
                            <div class="flex justify-between text-lg font-semibold">
                                <span class="text-mc-white">Total</span>
                                <span class="text-mc-white">Rs {{ order.total_amount }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Shipping Address -->
                <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30">
                    <h3 class="text-lg font-semibold mb-4 text-mc-white">üìç Shipping Address</h3>
                    <div class="text-mc-light-grey">
                        <p>{{ order.address.street_address }}</p>
                        <p>{{ order.address.city }}, {{ order.address.state }}</p>
                        <p>{{ order.address.postal_code }}</p>
                        <p class="text-sm mt-2 text-mc-grey">{{ order.address.get_address_type_display }}</p>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30">
                    <h3 class="text-lg font-semibold mb-4 text-mc-white">üìû Contact Information</h3>
                    <div class="space-y-3">
                        <div>
                            <p class="text-mc-light-grey text-sm">Email</p>
                            <p class="text-mc-white font-semibold">{{ order.user.email }}</p>
                        </div>
                        {% if order.user.phone_number %}
                        <div>
                            <p class="text-mc-light-grey text-sm">Phone Number</p>
                            <p class="text-mc-white font-semibold">{{ order.user.phone_number }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Order Timeline -->
                <div class="bg-mc-dark rounded-xl p-6 border border-mc-grey/30">
                    <h3 class="text-lg font-semibold mb-4 text-mc-white">üìÖ Order Timeline</h3>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-mc-accent rounded-full mt-2"></div>
                            <div>
                                <p class="text-mc-white font-semibold">Order Placed</p>
                                <p class="text-mc-light-grey text-sm">{{ order.created_at|date:"F d, Y g:i A" }}</p>
                            </div>
                        </div>
                        {% if order.updated_at != order.created_at %}
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-mc-grey rounded-full mt-2"></div>
                            <div>
                                <p class="text-mc-white font-semibold">Last Updated</p>
                                <p class="text-mc-light-grey text-sm">{{ order.updated_at|date:"F d, Y g:i A" }}</p>
                            </div>
                        </div>
                        {% endif %}
                        {% if order.shipped_date %}
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                            <div>
                                <p class="text-mc-white font-semibold">Order Shipped</p>
                                <p class="text-mc-light-grey text-sm">{{ order.shipped_date|date:"F d, Y g:i A" }}</p>
                            </div>
                        </div>
                        {% endif %}
                        {% if order.actual_delivery_date %}
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                            <div>
                                <p class="text-mc-white font-semibold">Order Delivered</p>
                                <p class="text-mc-light-grey text-sm">{{ order.actual_delivery_date|date:"F d, Y g:i A" }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.status-badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}
.status-pending { background-color: #fff3cd; color: #856404; }
.status-confirmed { background-color: #d1ecf1; color: #0c5460; }
.status-processing { background-color: #d4edda; color: #155724; }
.status-shipped { background-color: #cce5ff; color: #004085; }
.status-out_for_delivery { background-color: #e2e3e5; color: #383d41; }
.status-delivered { background-color: #d4edda; color: #155724; }
.status-cancelled { background-color: #f8d7da; color: #721c24; }
.status-returned { background-color: #f8d7da; color: #721c24; }
</style>
{% endblock %}
